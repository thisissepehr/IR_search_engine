{"paper_id": "290233a9894cc9608e11fdf6172b186c55aa849f", "metadata": {"title": "Digital image Analysis of Heterogeneous tuberculosis pulmonary pathology in non- clinical Animal Models using Deep convolutional neural networks", "authors": [{"first": "Bryce", "middle": ["C"], "last": "Asay", "suffix": "", "affiliation": {"laboratory": "Mycobacteria Research Laboratories", "institution": "Colorado State University", "location": {"addrLine": "Fort Collins", "region": "Colorado", "country": "United States of America"}}, "email": ""}, {"first": "Blake", "middle": [], "last": "Blue Edwards", "suffix": "", "affiliation": {"laboratory": "Mycobacteria Research Laboratories", "institution": "Colorado State University", "location": {"addrLine": "Fort Collins", "region": "Colorado", "country": "United States of America"}}, "email": ""}, {"first": "Jenna", "middle": [], "last": "Andrews", "suffix": "", "affiliation": {"laboratory": "Mycobacteria Research Laboratories", "institution": "Colorado State University", "location": {"addrLine": "Fort Collins", "region": "Colorado", "country": "United States of America"}}, "email": ""}, {"first": "Michelle", "middle": ["E"], "last": "Ramey", "suffix": "", "affiliation": {"laboratory": "Mycobacteria Research Laboratories", "institution": "Colorado State University", "location": {"addrLine": "Fort Collins", "region": "Colorado", "country": "United States of America"}}, "email": ""}, {"first": "Jameson", "middle": ["D"], "last": "Richard", "suffix": "", "affiliation": {"laboratory": "Mycobacteria Research Laboratories", "institution": "Colorado State University", "location": {"addrLine": "Fort Collins", "region": "Colorado", "country": "United States of America"}}, "email": ""}, {"first": "Brendan", "middle": ["K"], "last": "Podell", "suffix": "", "affiliation": {"laboratory": "Mycobacteria Research Laboratories", "institution": "Colorado State University", "location": {"addrLine": "Fort Collins", "region": "Colorado", "country": "United States of America"}}, "email": ""}, {"first": "Juan", "middle": ["F"], "last": "Mu\u00f1oz Guti\u00e9rrez", "suffix": "", "affiliation": {"laboratory": "Mycobacteria Research Laboratories", "institution": "Colorado State University", "location": {"addrLine": "Fort Collins", "region": "Colorado", "country": "United States of America"}}, "email": ""}, {"first": "Chad", "middle": ["B"], "last": "Frank", "suffix": "", "affiliation": {"laboratory": "Mycobacteria Research Laboratories", "institution": "Colorado State University", "location": {"addrLine": "Fort Collins", "region": "Colorado", "country": "United States of America"}}, "email": ""}, {"first": "Magunda", "middle": [], "last": "", "suffix": "", "affiliation": {}, "email": ""}, {"first": "Gregory", "middle": ["T"], "last": "Robertson", "suffix": "", "affiliation": {"laboratory": "Mycobacteria Research Laboratories", "institution": "Colorado State University", "location": {"addrLine": "Fort Collins", "region": "Colorado", "country": "United States of America"}}, "email": ""}, {"first": "Michael", "middle": [], "last": "Lyons", "suffix": "", "affiliation": {"laboratory": "Mycobacteria Research Laboratories", "institution": "Colorado State University", "location": {"addrLine": "Fort Collins", "region": "Colorado", "country": "United States of America"}}, "email": ""}, {"first": "Asa", "middle": [], "last": "Ben-Hur", "suffix": "", "affiliation": {"laboratory": "Mycobacteria Research Laboratories", "institution": "Colorado State University", "location": {"addrLine": "Fort Collins", "region": "Colorado", "country": "United States of America"}}, "email": ""}, {"first": "Anne", "middle": ["J"], "last": "Lenaerts", "suffix": "", "affiliation": {"laboratory": "Mycobacteria Research Laboratories", "institution": "Colorado State University", "location": {"addrLine": "Fort Collins", "region": "Colorado", "country": "United States of America"}}, "email": "lenaerts@colostate.edu"}]}, "abstract": [{"text": "Efforts to develop effective and safe drugs for treatment of tuberculosis require preclinical evaluation in animal models. Alongside efficacy testing of novel therapies, effects on pulmonary pathology and disease progression are monitored by using histopathology images from these infected animals. to compare the severity of disease across treatment cohorts, pathologists have historically assigned a semi-quantitative histopathology score that may be subjective in terms of their training, experience, and personal bias. Manual histopathology therefore has limitations regarding reproducibility between studies and pathologists, potentially masking successful treatments. This report describes a pathologist-assistive software tool that reduces these user limitations, while providing a rapid, quantitative scoring system for digital histopathology image analysis. The software, called 'Lesion Image Recognition and Analysis' (LIRA), employs convolutional neural networks to classify seven different pathology features, including three different lesion types from pulmonary tissues of the C3HeB/FeJ tuberculosis mouse model. LIRA was developed to improve the efficiency of histopathology analysis for mouse tuberculosis infection models, this approach has also broader applications to other disease models and tissues. the full source code and documentation is available from https://Github. com/TB-imaging/LIRA. Tuberculosis (TB) is a communicable disease which continues to affect modern society with a quarter of the world believed to have active or latent TB, primarily in low and middle income countries 1,2 . TB is transmitted by aerosol inhalation of the bacterium Mycobacterium tuberculosis (Mtb) from an infected individual. During the course of infection, a wide variety of pulmonary disease lesion presentations may concurrently present within the same host 3-5 . This pulmonary pathology includes, but is not limited to, inflammatory lesions, interstitial pneumonia, necrotic caseating granulomas encapsulated within a fibrotic rim, non-cavitary necrotic lesions, non-necrotic cellular lesions, and cavitary lesions 6,7 . The heterogeneity of lesions within a single individual represent a myriad of microenvironments for Mtb that range from hypoxic regions where bacteria are extracellular in caseum, to vascularized and more aerated regions where Mtb is intracellular within various macrophage populations 8, 9 . Because of the complex environments that develop in the lung throughout infection, Mtb has developed adaptive strategies to alter its metabolism and replicative state in order to increase survival 10-13 . The adaptation of Mtb to its environment results in bacterial populations exhibiting multiple distinct phenotypes 8, 14 . A critical component in understanding disease outcome and, importantly, treatment success is our understanding of these varying lesion", "cite_spans": [{"start": 2422, "end": 2424, "text": "8,", "ref_id": "BIBREF7"}, {"start": 2748, "end": 2750, "text": "8,", "ref_id": "BIBREF7"}], "ref_spans": [], "section": "Abstract"}], "body_text": [{"text": "microenvironments and bacterial phenotypes [15] [16] [17] . Two important clinical implications emerge from the lesion heterogeneity observed in lungs of TB patients in terms of the effectiveness of drug treatment in the various lesion types and lesion compartments. Lesion characteristics differentially affect (1) drug penetration and distribution of TB drugs inside the lung lesions where the bacteria are located 18 , and (2) the relative drug susceptibility of the bacilli contained within these lesions due to metabolic adaptation that could induce phenotypic drug tolerance and bacterial persistence 8, 19 . These combined factors result in marked inter-and intra-lesional variability of drug-mediated killing. We have reported previously on the C3HeB/FeJ mouse model, which after Mtb aerosol infection, develops a heterogeneity of pulmonary lesion types more reflective of the lung pathology seen in TB patients, and which has proven useful to further our understanding of disease progression as well as studying treatment responses for emerging therapies 13, [20] [21] [22] [23] .", "cite_spans": [{"start": 43, "end": 47, "text": "[15]", "ref_id": "BIBREF15"}, {"start": 48, "end": 52, "text": "[16]", "ref_id": "BIBREF16"}, {"start": 53, "end": 57, "text": "[17]", "ref_id": "BIBREF17"}, {"start": 607, "end": 609, "text": "8,", "ref_id": "BIBREF7"}, {"start": 1064, "end": 1067, "text": "13,", "ref_id": "BIBREF13"}, {"start": 1068, "end": 1072, "text": "[20]", "ref_id": "BIBREF20"}, {"start": 1073, "end": 1077, "text": "[21]", "ref_id": "BIBREF21"}, {"start": 1078, "end": 1082, "text": "[22]", "ref_id": "BIBREF22"}, {"start": 1083, "end": 1087, "text": "[23]", "ref_id": "BIBREF23"}], "ref_spans": [], "section": ""}, {"text": "Murine models are employed in TB research due to their small size and low cost, and in addition, their physiology and genetics are well understood. Standard laboratory mouse strains such as C57BL/6 and Balb/c, have been used most widely for TB research. However, these mouse strains show limitations by solely developing a single lesion type after Mtb infection and they lack the lesion heterogeneity seen in TB patients. The C3HeB/ FeJ TB infection model presents with a heterogeneity of pulmonary lesion types more reflective of human disease 20, 21 . This mouse model was first described for tuberculosis by Igor Kramnik et al. ( and is therefore also more commonly referred to as \"the Kramnik mouse model\") 24 . These mice developed a de novo recessive allele, identified in a region at the 54.0-cM location of chromosome 1, termed the 'super susceptibility to tuberculosis -1' locus (sst1) 25 . The susceptible sst1 allele was reported to control the formation of caseous necrosis of pulmonary lesions. In C3HeB/FeJ mice after an Mtb infection with a low inoculum, the bacterial load increases to high bacterial numbers in lungs, and mice develop a chronic disease state with a dramatic progression of the lung pathology over time. After 8 weeks post infection, three pulmonary lesion types can be identified which we classified earlier 20, 21 , as: (i) a highly organized encapsulated caseous necrotic granuloma defined as a Type I lesion, (ii) a neutrophil dominated lesion with cellular necrosis defined as a Type II lesion, and (iii) cellular lesions with distinct clusters of lymphocytes defined as a Type III lesion type. Both the Type I and II lesion types contain high bacterial numbers (up to 10 6-7 per lesion), whereas the smaller Type III lesions only show few bacteria (up to 10 2-3 per lesion). All three lesions types can be present at the same time within a single mouse, and even in a single lung lobe 21 . Occasionally cavities have been observed, although this has been an infrequent event in the C3HeB/FeJ mouse model infected with Mtb H37Rv or Erdman 20, 26 .", "cite_spans": [{"start": 545, "end": 548, "text": "20,", "ref_id": "BIBREF20"}, {"start": 616, "end": 632, "text": "Kramnik et al. (", "ref_id": null}, {"start": 1342, "end": 1345, "text": "20,", "ref_id": "BIBREF20"}, {"start": 2077, "end": 2080, "text": "20,", "ref_id": "BIBREF20"}], "ref_spans": [], "section": ""}, {"text": "The efficacy of tuberculosis vaccines 27, 28 or drugs 29, 30 is primarily measured by determining the reduction in bacterial load in target organs. The quantification of lung involvement in disease has proven to be informative as a secondary readout. A thorough pathology assessment can be informative to assess the effect of the therapeutic intervention on the disease itself, by studying improvement or worsening of inflammation or measures of tissue repair, such as fibrosis, as well as revealing potential immunotoxicities. Serial positron emission tomography (PET) and computed tomography (CT) scans of M. tuberculosis-infected animals and TB patients have been used to monitor disease progression and response to treatment [31] [32] [33] , allowing precise quantitation of the extent of disease and inflammatory response of the host. Parallel studies of cynomolgus macaques and humans have shown comparable rates of radiological response to linezolid 34 , and based on these initial studies, radiographic surrogate markers are being actively explored for use in human clinical trials of new agents and TB regimens [35] [36] [37] . For mouse models used in preclinical testing for TB, the treatment effect on pulmonary pathology is generally examined on microscopic images using a histological grading system by a veterinary pathologist specialized in TB 38 . The pathologist then assesses both macroscopic recognition of larger pathologic structures such as lesion types, as well as microscopic identification of predominate immune cell types. Because of the complex nature of the classification process, quantification of the lesions and their lung involvement for research purposes is not only a specialized task but highly time-consuming and variable upon the individual performing the analysis. The person-to-person variability and subject nature of the method can lead to differing results, and this will in addition make inter-experiment comparisons of the histopathology results difficult. The manual time-consuming analysis can lead to increased user fatigue and reduced focus, which in itself can lead to introduction of more inaccuracies.", "cite_spans": [{"start": 38, "end": 41, "text": "27,", "ref_id": "BIBREF27"}, {"start": 54, "end": 57, "text": "29,", "ref_id": "BIBREF29"}, {"start": 729, "end": 733, "text": "[31]", "ref_id": "BIBREF31"}, {"start": 734, "end": 738, "text": "[32]", "ref_id": "BIBREF32"}, {"start": 739, "end": 743, "text": "[33]", "ref_id": "BIBREF33"}, {"start": 1120, "end": 1124, "text": "[35]", "ref_id": "BIBREF35"}, {"start": 1125, "end": 1129, "text": "[36]", "ref_id": "BIBREF36"}, {"start": 1130, "end": 1134, "text": "[37]", "ref_id": "BIBREF37"}], "ref_spans": [], "section": ""}, {"text": "While histopathology analysis of TB lung lesions is complex, recent advances in machine learning can provide for certain aspects of such analyses to be automated. Areas such as digital image analysis in cancer research [39] [40] [41] , magnetic resonance imaging/computed tomography 42, 43 , and clinical and anatomical pathology 44, 45 have seen an increase of analysis tools being developed using machine learning approaches. Many of the algorithms currently employed in the medical digital imaging field include convolutional neural networks (CNN) [46] [47] [48] [49] , and support vector machines (SVM) 50, 51 . CNNs are neural networks designed specifically for images, and address the issue of achieving classification invariance for object recognition using local feature extractors or filters. These feature extractors or filters are applied at increasing levels of granularity, thereby allowing the system to recognize features at increasing levels of abstraction similarly to how the brain processes visual stimuli 52, 53 . CNNs also have a demonstrated history of success in image classification, and a plethora of open source tools and packages are widely available for use 54 .", "cite_spans": [{"start": 219, "end": 223, "text": "[39]", "ref_id": "BIBREF39"}, {"start": 224, "end": 228, "text": "[40]", "ref_id": "BIBREF40"}, {"start": 229, "end": 233, "text": "[41]", "ref_id": "BIBREF41"}, {"start": 283, "end": 286, "text": "42,", "ref_id": "BIBREF42"}, {"start": 330, "end": 333, "text": "44,", "ref_id": "BIBREF44"}, {"start": 334, "end": 336, "text": "45", "ref_id": null}, {"start": 551, "end": 555, "text": "[46]", "ref_id": "BIBREF46"}, {"start": 556, "end": 560, "text": "[47]", "ref_id": "BIBREF47"}, {"start": 561, "end": 565, "text": "[48]", "ref_id": "BIBREF48"}, {"start": 566, "end": 570, "text": "[49]", "ref_id": "BIBREF49"}, {"start": 607, "end": 610, "text": "50,", "ref_id": "BIBREF50"}, {"start": 1025, "end": 1028, "text": "52,", "ref_id": "BIBREF52"}, {"start": 1186, "end": 1188, "text": "54", "ref_id": null}], "ref_spans": [], "section": ""}, {"text": "In this work, we propose a TB lesion machine learning classifier that follows established classification criteria developed in our laboratory which distinguishes three different lesion types that develop in the C3HeB/FeJ mouse TB infection model 20, 21 . This digital image analysis software package was developed as a modular neural network [55] [56] [57] [58] , consisting of three CNNs, each optimized for a specific sub-task, together with two human intervention checkpoints to limit the probability of misclassification (Figs. 1, 2) . This digital image analysis pipeline is named 'Lesion Image Recognition and Analysis' , or LIRA. From its inception, LIRA was designed to work in conjunction with pathologists with the goal to improve the analysis of pulmonary pathology to be more efficient, accurate, and reproducible regardless of the individual analyzing the whole slide images.", "cite_spans": [{"start": 246, "end": 249, "text": "20,", "ref_id": "BIBREF20"}, {"start": 342, "end": 346, "text": "[55]", "ref_id": "BIBREF55"}, {"start": 347, "end": 351, "text": "[56]", "ref_id": "BIBREF56"}, {"start": 352, "end": 356, "text": "[57]", "ref_id": "BIBREF57"}, {"start": 357, "end": 361, "text": "[58]", "ref_id": null}], "ref_spans": [{"start": 525, "end": 537, "text": "(Figs. 1, 2)", "ref_id": "FIGREF0"}], "section": ""}, {"text": "Ability of CNN1 to identify caseous necrotic (Type I) lesions. After training CNN1 with the digital image training set, a validation step was introduced to evaluate the sensitivity, specificity and false positive (1) The original digital image scan is uploaded, (2) CNN1 detects Type I pulmonary lesions and results are verified by the user, (3) Window location is cropped based upon classification, (4) Image is tiled in individual image patches of 80 \u00d7 145 pixel size to generate predictions, (5) Classification predictions generated using both CNNs, (6) User is allowed to edit the results one last time. rate of classifying Type I lesion cores. After an image is uploaded, the Type I object detector (CNN1) is used to macroscopically detect the caseous necrotic center of Type I lesions (Figs. 1,2 ). LIRAs CNN1, the Type I object detector, showed to be consistent in identifying and delineating Type I lesion structures, with a sensitivity of 86.36%. CNN1 however shows a high false positive rate by misclassifying other lesion types for a Type I with the specificity of 55.11%. Most misclassifications occurred when large areas of cellular necrosis were visible in the center of Type II lesions, which on a single image patch shows a similar cellular composition as the Type I cores. The high recall rate is likely the result of the training set for the creation of CNN1, having an insufficient number of images needed for training. To decrease the false positive rate for CNN1, continued training with a larger training set might be an area of improvement for future iterations. Despite the high recall rate, we opted to retain CNN1 as it facilitated the rapid identification of Type I lesions for the user, and it provided an accurate demarcation of its margins from surrounding lesions or tissue. For instance, the validation results showed that the inclusion of CNN1 decreased the inconsistencies seen after hand labeling among multiple pathologists in identifying and demarcation of the Type I Rim. However, it is possible that repeated false positive results could sway the less experienced user to misclassify over time. Therefore extra scrutiny is needed during the CNN1 step to limit potential bias of less experienced users which could lead to an increase of the number of false positives. Overall, the addition of CNN1 proved to be a substantial time saver as more time is allocated to accurately identify the margins of the Type I lesions than in the removal of a potential misclassification.", "cite_spans": [], "ref_spans": [{"start": 791, "end": 801, "text": "(Figs. 1,2", "ref_id": "FIGREF0"}], "section": "Results"}, {"text": "The accuracy for LIRA in comparison to an experienced TB researcher. After the initial positive or negative classification by the macroscopic object detector CNN1, the areas designated as Type I were further classified by CNN2, and the remaining image patches were classified in parallel by CNN3 (Figs. 1,2) . To determine the accuracy of the overall pipeline (Fig. 2) , a ground truth was established on 12 digital images by a researcher with substantial experience analyzing C3HeB/FeJ mouse pathology. These 12 images consisted of lung lobes composed of three Type I dominated tissues, three Type II dominated tissues, three Type III dominated tissues, and three predominately Healthy tissues. Total image patch counts for only the classification of interest were used to calculate the percent error per individual classification. The results for LIRA without human intervention were then compared to the manual labeling results by the researcher. As seen in Table 1 , the overall percent error for all seven classifications was 12.11% across all 12 digital images. Healthy Tissue and Type III had the lowest percent error, while Type II had the highest percent error at 38.37%.", "cite_spans": [], "ref_spans": [{"start": 296, "end": 307, "text": "(Figs. 1,2)", "ref_id": "FIGREF0"}, {"start": 360, "end": 368, "text": "(Fig. 2)", "ref_id": "FIGREF1"}, {"start": 961, "end": 968, "text": "Table 1", "ref_id": null}], "section": "Results"}, {"text": "The high percent error observed for the Type II lesions for LIRA compared to the experienced researcher was the result of poor demarcation by LIRA of the surrounding lesion tissue, which is often composed of compressed tissue and in some cases aggregates of extracellular DNA (potentially NETs). Compressed tissue results from lesions pressing into healthy lung parenchyma, which changes the morphological structure. The aggregates of extracellular DNA are considered part of a Type II lesion, whereas compressed tissue as defined here is considered \"Healthy Tissue\". Another area contributing to the decrease in accuracy by LIRA was from processing artifacts to generate the microscope slides. These included areas of high red blood cell numbers, which were incorrectly classified by LIRA as Type III. Also, minor differences in the staining procedure of the microscope slides affected the intensity and colors of the tissue and its images, which resulted in slight differences in classification by LIRA. Lastly, sectioning artifacts such as microtome occasional knife chatter, lines, or fragment holes were also prone to result in misclassification by LIRA. Improved agreement of histopathology classifications among pathologists using LIRA. To evaluate the performance of LIRA in terms of reproducibility and concordance between users, a second validation step was included using a previously unseen digital image set. Seven randomly selected scanned images of single lung lobes were used for this validation step. The goal for this validation step was to compare the pathology classification results from the classical pathology analysis approach of four pathologists or four research technicians, to the prediction results of LIRA with pathologist assistance (see Supplemental Fig. 1 ). The comparison focused on three criteria: (1) the accuracy of both approaches in identifying the correct pathology classification; (2) the accuracy of demarcation of lesion margins that affects the area of lung involvement, and (3) the variability between users. For this purpose, the pathologists were first given seven images to classify each image patch by hand. After one week, the pathologists used the same seven digital images in a random order to classify each image patch now with the assistance of LIRA. Using the classical pathology approach, results of the four pathologists showed a consensus on the specific lesion classification in general, but did not always agree on the extent of the percent lung involvement (Supplemental Fig. 2 ). The disease classification categories with the most variability in results were Type I Rim and Type II lesion types, which subsequently also impacted indirectly the Healthy tissue classification.", "cite_spans": [], "ref_spans": [{"start": 1782, "end": 1788, "text": "Fig. 1", "ref_id": "FIGREF0"}, {"start": 2533, "end": 2539, "text": "Fig. 2", "ref_id": "FIGREF1"}], "section": "Results"}, {"text": "Healthy Tissue (n = 3) As LIRA makes classification predictions per image patch at a microscopic level, it became clear in the validation step that both CNN2 and CNN3 can identify certain areas of a single lesion as one classification whereas another area of the same lesion could be identified as a different classification. An example of this can be observed in Supplemental Fig. 2 (Image 3), which consists of one Type I and multiple Type III lesions. In this example for the pathologist-only readout, an observed disagreement was seen for the demarcation of the Type I Rim and the start of the Type III lesion that is adjacent to it. Only one of the four pathologists (pathologist 2) had accurately identified neutrophil-rich regions of the Type III lesion (in green), which is an unusual event for a Type III lesion. For the pathologist-assisted LIRA results (Supplemental Fig. 2 ), three out of four pathologists decided to reduce the lung area for the Type I lesion after being prompted by LIRA. In addition, all four pathologists recognized regions of neutrophil infiltration only after the assistance of LIRA (in green). Another disagreement between pathologists was observed regarding the classification of bronchial airways and artifacts. For the pathologist-only readout, two out of four pathologists classified the bronchial airways as Healthy tissue, and the two remaining pathologists classified these regions as Empty slide. The same was observed for a tissue processing artifact visible on the image scan (a fragment hole artifact), which was classified by two pathologists as Healthy tissue and by the other two as Empty slide. With the assistance of LIRA, the results for all four pathologists were now in agreement, and both the bronchial airways and the artifact were classified correctly as Empty slide. The change in classification that occurred at the pathologists' checkpoints after CNN2 and CNN3 showed to have a significant impact on the output data in terms of reducing the variability and increasing reproducibility of the results.", "cite_spans": [], "ref_spans": [{"start": 377, "end": 383, "text": "Fig. 2", "ref_id": "FIGREF1"}, {"start": 878, "end": 884, "text": "Fig. 2", "ref_id": "FIGREF1"}], "section": "LIRA % Error"}, {"text": "Reproducibility of histopathology analysis regardless of the pathologist analyzing the data, or the variation that can occur over time is important when comparing data across preclinical studies or laboratories. To measure whether the agreement between pathologists increased with the assistance of LIRA, multi-rater percent agreement and the Nominal Krippendorff 's alpha approach were used. Each image patch was considered a separate observation for the analysis, and the percent agreement was calculated per image. The multi-rater average percent agreement without LIRA for the four pathologists across all images was 87%. Images showing the lowest agreement consisted of primarily Type I (Images 1&3) and the Misc. classification (Image 7) ( Table 2 and Fig. 3D ). With the assistance of LIRA, the percent agreement for the four pathologists increased across all images, and there was a 53% decrease in disagreement overall to achieve an overall agreement of 94%. The most prominent increase in percent agreement was observed for the images containing Type I lesions and the Misc. classification.", "cite_spans": [], "ref_spans": [{"start": 746, "end": 753, "text": "Table 2", "ref_id": null}, {"start": 758, "end": 765, "text": "Fig. 3D", "ref_id": "FIGREF2"}], "section": "LIRA % Error"}, {"text": "Using a more refined additional metric of analysis, the Krippendorff 's statistical analysis approach was used for calculating the nominal alpha coefficient. Again, each image patch classification by the four pathologists was seen as a separate observation. Manual labeling of seven pathology features for seven images by the four pathologists showed an average alpha of 0.796 (Table 2) , which is interpreted as tentative. Four of the seven classified images were below the 0.80 threshold, which means the pathologists failed to achieve good agreement on the classification of those images. In contrast, when performing the Krippendorff 's analysis on the data generated by the four pathologists with the assistance of LIRA, the calculated average alpha was 0.91 ( Table 2 ). The Krippendorff 's analysis results for all seven images were above the 0.80 threshold, and results for all seven images were above the 0.8 threshold which is considered good. These results confirmed our observations using percent error, providing further evidence of the benefits of LIRA assistance.", "cite_spans": [], "ref_spans": [{"start": 377, "end": 386, "text": "(Table 2)", "ref_id": null}, {"start": 766, "end": 773, "text": "Table 2", "ref_id": null}], "section": "LIRA % Error"}, {"text": "The increase in agreement among pathologists with the assistance of LIRA was the result of two main beneficial factors. First, the use of the LIRA software increased the accuracy of the demarcation of lesion margins, which affected indirectly the percent lung involvement in various categories. In addition, LIRA prompted the pathologist to revisit and re-analyze specific areas in the lungs, often small in size, which were often overlooked using the classical histopathology approach. Examples are shown in Fig. 3 (Pathologist 1, Pathologist 1 + LIRA) and Fig. 4 (Images 6 & 7), which show the improvement of lesion margin demarcation with LIRA assistance. With the use of LIRA, the classification of the pathological features not only improved the agreement between pathologists, but the results tended to be closer to the predictions made by the most experienced TB pathologist (Pathologist 4) (Supplemental Fig. 1 ). An example where LIRA prompted the user to re-analyze their initial prediction is shown in Fig. 3D . Here, a large area of fibrotic tissue is observed, which should have been classified as miscellaneous as it does not fit any other definition. With the assistance of LIRA, the pathologist changed the classification to miscellaneous, which was in agreement with the other three pathologists. The accuracy of classifying image features in the miscellaneous category is mostly dependent on the background and level of expertise of the user, and therefore this category will always be the most difficult to fully standardize across multiple users. The assistance www.nature.com/scientificreports www.nature.com/scientificreports/ of LIRA in the miscellaneous category, however, did minimize the misclassifications in this category and was an added benefit.", "cite_spans": [], "ref_spans": [{"start": 509, "end": 515, "text": "Fig. 3", "ref_id": "FIGREF2"}, {"start": 558, "end": 564, "text": "Fig. 4", "ref_id": "FIGREF3"}, {"start": 912, "end": 918, "text": "Fig. 1", "ref_id": "FIGREF0"}, {"start": 1013, "end": 1020, "text": "Fig. 3D", "ref_id": "FIGREF2"}], "section": "LIRA % Error"}, {"text": "In summary, the results of the validation tests showed a clear benefit of using LIRA assistance in the pathology readings by board certified pathologists, and this by improving the accuracy in demarcation of lesion margins as well as prompting the user to re-analyze certain areas thereby increasing conformity and reproducibility of an otherwise subjective readout. Additionally, compared to previous manual pathology analysis methods employed by the four pathologists taking about 15-30 min manual effort per lung lobe, an average decrease in manual analysis time of 82% was observed, now reducing the histopathology manual analysis to 3-10 min automated effort per lung lobe (with 5 minutes on average per lung lobe). trained research technicians + LiRA. In a final validation assessment, we investigated whether LIRA could be easily employed by research technicians, and how their prediction results would compare to those made by specialized pathologists. For this purpose, four research technicians were first trained in the identification of lesion types of the C3HeB/FeJ animal model (Trained Research Technician + LIRA). The technicians were then asked to analyze the same seven digital images of single lung lobe, as those evaluated by the pathologists for the validation step. The results showed that for the research technicians with assistance of LIRA, similar classification predictions were obtained as described earlier for the pathologists. Most notable was again the accurate demarcation of the lesions with LIRA assistance (Supplemental Fig. 2) . The results by research technicians assisted by LIRA exhibited a slightly higher variability, when compared to results of the pathologists assisted by LIRA. (1) Image number associated with the analysis, (2) the original H&E stained image without predictions, (3) The Type I object detector predictions made by CNN1 represented by red grid lines, (4) All predictions by the microscopic classifiers CNN2, CNN3, (5) Final classification changes made by user (Pathologist + LIRA), (6) Classifications made by user using manual labeling approach without software assistance (Pathologist).", "cite_spans": [], "ref_spans": [{"start": 1556, "end": 1563, "text": "Fig. 2)", "ref_id": "FIGREF1"}], "section": "LIRA % Error"}, {"text": "One area where the research technicians using LIRA showed less accurate results was in the identification of the Miscellaneous Tissue category. For example, in Image 7, a large area of fibrotic inflammation was not identified by the research technicians, whereas this was correctly classified by the pathologists using LIRA (Supplemental Fig. 2, Misc., Image 7) . Two out of 4 research technicians correctly identified fibrotic inflammation (Supplemental Fig. 2, Image 5) , which was also observed by the pathologists.", "cite_spans": [], "ref_spans": [{"start": 338, "end": 361, "text": "Fig. 2, Misc., Image 7)", "ref_id": "FIGREF1"}, {"start": 455, "end": 471, "text": "Fig. 2, Image 5)", "ref_id": "FIGREF1"}], "section": "LIRA % Error"}, {"text": "In summary, the output of the research technicians with LIRA was remarkably similar to that of the experienced pathologists using LIRA, except when uncommon or infrequent tissue types were present. Taken together, the data of the validation study indicates that even with implementation of AI, a certain level of pathology expertise is still preferred to accurately quantify certain unique lesion pathology.", "cite_spans": [], "ref_spans": [], "section": "LIRA % Error"}, {"text": "Traditional histopathological analysis generally involves an experienced board-certified pathologist often using a semi-quantitative scoring system to identify and quantify unique disease-specific pathology features 59, 60 . Specific scoring criteria are developed which can distinguish between various disease states thereby informing about disease progression or on effects of treatment intervention. These scoring criteria are then applied in double-blind histopathology analysis to reduce bias and variability. However, issues such as reproducibility between studies and variability in readouts by different pathologists still exist, and this continues to be an area of active research 61, 62 . In non-clinical TB animal studies used in drug and vaccine development, studies are often long term, require multiple time points, and generally occur in more than one laboratory to confirm that novel treatments or interventions are reproducibly efficacious. To evaluate the progression of pulmonary lesions in TB animal models, a histological grading system was developed years ago, based on grading granulomatous lesions for inflammatory cell numbers and their infiltrative distribution pattern 38 . The pathologist would then calculate a mean total lesion score for individual tissues; as normal (score of 1), mild (score: 1-3), moderate (score: 3-6), severe (score: [6] [7] [8] to reflect the disease state per animal. The variability in histopathology analysis between studies, time points, and individual pathologists, owing to the subjective nature of this method, was often substantial thereby making it difficult to interpret results. In addition, studies would be time-consuming and results over time affected by user fatigue. In this report, we describe the development of novel software for a rapid automated and unbiased digital image analysis using a machine learning approach based on convolutional neural networks to evaluate the histopathology of mouse models for tuberculosis in a quantitative manner. The goal was to make the software intuitive for its user, as well as facilitate and accelerate histopathology analysis for the non-expert.", "cite_spans": [{"start": 216, "end": 219, "text": "59,", "ref_id": "BIBREF60"}, {"start": 690, "end": 693, "text": "61,", "ref_id": "BIBREF62"}, {"start": 1369, "end": 1372, "text": "[6]", "ref_id": "BIBREF5"}, {"start": 1373, "end": 1376, "text": "[7]", "ref_id": "BIBREF6"}, {"start": 1377, "end": 1380, "text": "[8]", "ref_id": "BIBREF7"}], "ref_spans": [], "section": "Discussion"}, {"text": "We report here on the training and validation of a model for the accurate classification of seven pathology features using histopathology images. The model uses human classifications to learn robust features from a large number of H&E stained image patches. The model is currently suitable for quantitative lesion identification of the C3HeB/FeJ mouse model for tuberculosis. Initial attempts tried to implement a single convolutional neural network to identify all seven histopathology classifications. However, significant misclassification was observed caused by observing similar cell compositions in more than one lesion type. Therefore, LIRA was created using three individual neural networks to create a single modular network in order to generate more accurate predictions, based on both macroscopic-and microscopic histopathology events. Currently, the accuracy of the model is not sufficient to rely solely on the implementation of the LIRA software without any human intervention. Two human intervention checkpoints for the user are still required: first, to confirm and potentially modify the Type I lesion prediction (CNN1) and second, to confirm the individual image patch classifications made by LIRA (CNN2, CNN3). Moreover, human intervention can help prevent the misclassification of infrequent pathology events and artifacts on which the specific CNN had not previously been trained. Noteworthy, certain misclassifications by LIRA may ultimately be beneficial to the process as they can bring a particular pathology feature to the attention of the user, and can prompt the researcher for closer analysis. Future iterations will focus to improve the model by including additional datasets for training when more studies become available to increase LIRA's performance under all circumstances.", "cite_spans": [], "ref_spans": [], "section": "Discussion"}, {"text": "There were multiple advantages to using assistive software in identifying and quantifying disease states with digital image analysis. First, we observed a significant reduction in analysis time and user-fatigue whereby an 82% decrease in time was achieved for quantitative analysis in comparison to the standard histopathology scoring methodology. Second, with the assistance of the software, the variability of the predicted classifications among different pathologists was greatly reduced. Of importance, with the assistance of LIRA, a more accurate pathology comparison will be possible across multiple animal studies, different longitudinally time points, and studies performed at multiple laboratories. Where LIRA outperforms the individual pathologist is the consistent and accurate demarcation of lesion margins, as well as the detection of small regions on a microscopic level, which both substantially affect the quantitative analysis of the lesion area involvement. Pathologists and LIRA in most instances both correctly classify the lesion type, but the variability in the results from classical pathologist readouts is derived from the imprecise or inconsistent demarcation of lesion margins. Where pathologist expertise and intervention is still needed and preferred, is for the identification of infrequent pathology events or unusual artifacts. As also described for other applications in medical image analysis, diagnostic confidence never reaches 100% and combining machine learning and physician or pathologist experience reliably enhances system performance 63 .", "cite_spans": [], "ref_spans": [], "section": "Discussion"}, {"text": "During the development of the LIRA software it became apparent that the quality of tissue sample preparation can impact the accuracy of the results of the software. LIRA is affected by features such as the presence of high red blood cell numbers and processing artifacts, which led to the software incorrectly classifying these regions as pulmonary lesions instead of healthy tissue. Deviation from the sample preparation protocol presented in our methods section, including using frozen sections or changes in section thickness, will also result in a decrease in accuracy. When sample preparation varies, it is recommended that a new model be trained on image patches generated with these new protocols. In addition, the current iteration of LIRA is designed to identify lesion types for C3HeB/FeJ pulmonary tissue collected between 6-10 weeks post infection. We have tested LIRA on more commonly used BALB/c or C57BL/6 pulmonary tissues infected with Mtb, and results showed these mouse samples are also suitable for LIRA use. For the more conventional mouse models we now also opted to generate a new, simpler system. The recently developed software is similar to LIRA, but is solely composed of a single neural network that can generate classifications for TB lesion, Healthy, Unknown, and Empty, because the more traditional mouse models generally only develop one lesion type after infection with TB. Because the model is simpler, the readout will be faster than LIRA and have greater accuracy since it was designed specifically for those models. We also intend to make this code available in our open source repository. Lastly, we used multiple different image capture devices for generating the training set, however, all with similar image resolution. Although not observed in our setting, it is possible that different image variables such the resolution of the camera, image file format, and variability in staining intensities could alter the final output for LIRA. The optimal settings for LIRA at this time are a camera resolution between 0.33 to 0.5 microns/pixel with images saved as a Portable Network Graphics (PNG), image acquisition using the 20x objective, and following the staining procedure for H&E as described here.", "cite_spans": [], "ref_spans": [], "section": "Discussion"}, {"text": "A future direction to improve the current LIRA pipeline is to generate a new classification for the surrounding Type II tissue, and to increase the sensitivity of CNN1. LIRA predictions for Type II lesions could be significantly improved by creating a separate class for the surrounding tissue, primarily composed of aggregates of extracellular DNA and compressed tissue. And in addition, an increase of the Type I detector (CNN1) sensitivity might allow omission of the first human intervention checkpoint. The current false positive rate for the Type I core is the result of the limited sample numbers that were available at the time of training CNN1. Both an increase in the data available for training and the utilization of generative adversarial networks (GANs) 64 and pre-trained neural networks 65 represent possible future solutions. We are currently exploring additional machine learning and more traditional computer vision techniques to increase the specificity of the CNN1 model. This includes using pre-trained neural networks, histogram of oriented gradients (HOG), and Image segmentation. LIRA 2.0 is currently under development and will be made open source at the time after these improvements have been made.", "cite_spans": [], "ref_spans": [], "section": "Discussion"}, {"text": "A potential adaptation of LIRA's architecture for use in TB preclinical models could be an enhancement beyond just classification and quantification of infection in tissues. Researchers can combine lesion classification features with additional quantifiable measurements. Of particular interest in TB drug and vaccine development is to include the mycobacterial quantification metrics of each individual lesion. The goal would be to integrate precise measurements on bacterial numbers after fluorescent staining 21, 66 , as well as bacterial aggregation sizes, level of fluorescence, and the average number of bacteria as a metric of area. With the availability of matrix assisted laser desorption ionization (MALDI) imaging to assess drug levels across pulmonary lesions 67, 68 , one can envision the development of a model that would integrate data sets from digital lesion pathology with bacterial metrics as well as drug exposure.", "cite_spans": [{"start": 512, "end": 515, "text": "21,", "ref_id": "BIBREF21"}, {"start": 772, "end": 775, "text": "67,", "ref_id": "BIBREF68"}], "ref_spans": [], "section": "Discussion"}, {"text": "In conclusion, LIRA does not replace the histopathology analysis by pathologists but instead intends to improve the accuracy, speed, and reproducibility of the analysis. While there are certain limitations with the current model, these can easily be corrected and adjusted. The ability to more quickly and more accurately assess the effect of treatment interventions on histopathology of target organs will improve the evaluation of the efficacy of novel antibiotics and vaccines. Our demonstrated approach is not limited to TB and can be modified to include additional diseases and animal models, by creating new training sets and modifying the original architecture of LIRA to meet the needs of the researcher.", "cite_spans": [], "ref_spans": [], "section": "Discussion"}, {"text": "Sample collection from archived animal studies. The digital images from pulmonary samples used for the development of the image analysis software package were derived from archived C3HeB/FeJ mouse studies conducted for the development of the mouse model 20, 21 , for drug efficacy trials using existing and novel drugs for tuberculosis 13, 22 , and studies focusing on virulence of various Mtb strains (unpublished results). Lung samples were collected from 14 previous independent mouse studies, conducted over several years (from 2012-2018), and samples were obtained from two different research laboratories at CSU. Mtb strains used for the mouse infection studies included M. tuberculosis Erdman (TMC 107, purchased from ATCC), HN878 (Clinical Isolate W210, CSU, Fort Collins, CO, available at BEI resources), or H37Rv (Trudeau Institute, Saranac Lake, New York). Bacteria for mouse infections were initially grown as a pellicle and further propagated in Proskauer-Beck medium containing 0.05% Tween 80 (Sigma Chemical Co., St. Louis, MO), never extending past mid-log phase 69 . Female C3HeB/FeJ mice, 6-8 weeks of age (Jackson Laboratories, Bar Harbor, ME) were housed in a bio-safety level III animal facility and exposed to an Mtb aerosol infection using a Glas-Col inhalation exposure system 70 . Mice were euthanized by CO 2 inhalation, between 4-10 weeks post aerosol exposure. Whole lungs were fixed by inflation with 4% paraformaldehyde (Electron Microscopy Sciences, Hatfield, PA) in phosphate buffered saline solution (PBS) via cardiac perfusion before subsequently being transferred to a 70% ethanol solution 48 hours later.", "cite_spans": [{"start": 254, "end": 257, "text": "20,", "ref_id": "BIBREF20"}, {"start": 336, "end": 339, "text": "13,", "ref_id": "BIBREF13"}], "ref_spans": [], "section": "Methods"}, {"text": "processing of samples to generate the digital image dataset. Fixed lung samples were further processed at either Premier Laboratory (Boulder, CO), the Experimental Pathology Facility at CSU (Fort Collins, CO), or at the Microbiology, Immunology and Pathology (MIP) Department. Pulmonary tissue samples were placed in a single cassette per mouse, then paraffin embedded and sectioned. Tissue sections (5 \u00b5m) with the largest surface area were used for further histopathology analysis and mounted on glass slides. Paraffin sections processed for Haemotoxylin and Eosin (H&E) staining underwent a Xylene bath for 10 min before undergoing gradient hydration. Samples were stained using a Leica ST5020 instrument with an initial staining step using Hematoxylin 560 (Leica Selectech, Buffalo Grove, IL) for 5 min and rinsed in tap water. Next, the slides were washed using a Define wash step (Leica Selectech, Buffalo Grove, IL) for 10 sec before being placed in a Blue Buffer Solution (Leica Selectech, Buffalo Grove, IL) for 1 min. The slides were then rinsed with Eosin for 1 min www.nature.com/scientificreports www.nature.com/scientificreports/ before being transferred to 96 Eosin Y 515 (Leica Selectech, Buffalo Grove, IL) for 3 min. The final step included a washing step with 96% EtOH for 6 min before being mounted using a LEICA CV5030 Mounting instrument (Leica Selectech, Buffalo Grove, IL), thereby using the Coverseal-X Xylene Mounting Media (Cancer Diagnostic Inc., Durham, NC). Slides were generated and stained at three facilities using similar, however not the exact same, protocols over a time span of several years (2012-2018). Digital image scans from microscopic slides containing C3HeB/FeJ lungs were generated from one of three image capture devices. Image scans from Premier Laboratories (Longmont, CO) were generated on an Aperio Scanscope XT digital slide scanner (Nikon, Melville, NY) at 20x magnification. At the Experimental Pathology Core (CSU), the images were acquired using an Olympus VS120 digital slide scanner (Olympus, Center Valley, PA) using the Olympus VS-ASW software (v.2.9; Olympus, Center Valley, PA) at 20x magnification. Images acquired in the MIP Department were generated on a Nikon Eclipse Ti robotic inverted microscope with a DS-Qi1Mc digital camera (Nikon, Melville, NY) at 20x magnification, using the Nikon NIS Elements AR software (v. 4.51.00; Nikon, Melville, NY). In total, 86 slides were scanned on the Aperio Scanscope, 84 slides were scanned on the Olympus VS120 and 6 images were generated on the Nikon inverted microscope. All three imaging devices used for generating whole slide images show similar image resolutions, with 0.5 microns/pixel for the Aperio XT, and <0.33 micron/pixel for the Olympus VS120, and 0.322 micron/pixel for the Nikon camera at 20x magnification. Therefore, limited variability in digitizing the results was expected by the different image capture devices used. The variability between images was mainly caused by the nature of collecting biological data and differences in sample processing (processing by different technicians, using slight modifications of H&E staining protocols). This was merely seen as an asset for developing the software since it provided a realistic level of noise or variability to our data reflecting results expected in future. In total, for the training and subsequent validation of LIRA, lung sections from 176 mice were scanned digitally to generate 176 digital image scans (containing all five lung lobes for every mouse per microscopic slide and per digital image scan). To reduce the file size of the image scans, digital image files were generated for every individual lung lobe (resulting in five digital image files per mouse).", "cite_spans": [], "ref_spans": [], "section": "Methods"}, {"text": "Lesion and histopathology classification scheme. The histopathology classifications used for the creation of the training, test, and validation sets included the original classifications of pulmonary lesion types in the C3HeB/FeJ mouse model, as previously described by Lenaerts et al. 20, 21 . Briefly, C3HeB/FeJ mice present with three distinct pulmonary lesion types after an Mtb aerosol infection. Type I lesions show well organized, caseous, necrotic lesions with a layer of foamy macrophages around a core composed of neutrophilic debris, which is surrounded by a collagen rim with interstitial macrophages admixed within the rim. Type I lesions contain high bacterial numbers, which are either extracellularly located in the lesion core, or intracellular in foamy macrophages. The Type II lesions are less organized with a massive recruitment of neutrophils, resulting in large areas of alveolar wall necrosis throughout the lung parenchyma. Type II lesions also contain high bacterial numbers, both intraand extracellularly. Type III lesions develop as a result of accumulation of lymphocytes, epithelioid, and foamy macrophages as well as small pockets of neutrophils. The latter is similar to the main lesion type described for other immunocompetent mouse strains such as the BALB/c and C57BL/6 [71] [72] [73] .", "cite_spans": [{"start": 270, "end": 289, "text": "Lenaerts et al. 20,", "ref_id": null}, {"start": 1305, "end": 1309, "text": "[71]", "ref_id": "BIBREF72"}, {"start": 1310, "end": 1314, "text": "[72]", "ref_id": "BIBREF73"}, {"start": 1315, "end": 1319, "text": "[73]", "ref_id": "BIBREF74"}], "ref_spans": [], "section": "Methods"}, {"text": "In addition to the lesion classifications, other histopathology categories were added for the machine learning approach in order to ensure inclusion of healthy tissue, non-Mtb specific lung pathology, artifacts, and an empty slide feature. In total, seven classification categories were identified, which were as follows: Type I Rim, Type I Core, Type II, Type III, Healthy, Miscellaneous (Misc.), and Empty slide. Each classification is characterized by certain macroscopic pathology features, as well as microscopic features based on multiple different cell types. Each of the seven classifications are described in detail below, and are presented in Fig. 1 .", "cite_spans": [], "ref_spans": [{"start": 653, "end": 659, "text": "Fig. 1", "ref_id": "FIGREF0"}], "section": "Methods"}, {"text": "The Type I (caseous necrotic) pulmonary lesion type is characterized by two distinct pathology features which include a collagen rim and a caseous necrotic core. For this reason, the Type I lesion was categorized into two distinct classifications for the analysis, defined here as the 'Type I Rim' and 'Type I Core' categories. The Type I Core is composed of central necrosis surrounded by a dense neutrophilic debris layer, and a foamy macrophage layer which lies within the collagen rim. The Type I Rim composition includes the collagen rim and the outside layer composed of fibroblasts, epithelioid, and activated macrophages, and clusters of lymphocytic cells. The 'Type II' pulmonary lesion consists primarily of large numbers of neutrophils at times visible as a honeycomb-like structure of lung parenchyma. Along the periphery of the Type II lesion, the presence of aggregates of extracellular DNA, pockets of lymphocytes, and compressed tissue can be present. These pathology features are mostly found in close proximity and therefore also classified as Type II. The 'Type III' pulmonary lesions are cellular inflammatory lesions composed primarily of epithelioid, foamy and activated macrophages, large numbers of lymphocytes, and small pockets of neutrophils. The 'Healthy' classification is here reserved for tissue features, such as healthy lung parenchyma, bronchiole epithelium, blood vessels, compressed tissue, and any other pulmonary tissues that are present in healthy individuals. The 'miscellaneous' classification encompasses a broad array of tissue pathology features that are not found in healthy tissue, that are not part of the specified TB lesions, and are not associated with healthy pulmonary tissue. The miscellaneous classification includes pleural pneumonia, adipose tissue, non-TB specific inflammation, as well as staining and processing artifacts. Lastly, the 'empty slide' classification was included as a separate category, although this classification was ultimately not included in the final performance and accuracy analysis of the results. the LiRA pipeline. LIRA was developed as a modular neural network. This implementation of multiple neural networks working together follows the natural logic employed by trained researchers to classify lesions by intuitively first investigating on a more general, macroscopic level (for Type I lesion recognition), followed by a more detailed analysis on a microscopic level to identify other pathological features on a cellular level. In preliminary work, we used a single CNN to identify all seven classifications. However, due to similarities between multiple lesion types at a microscopic scale (such as the necrosis encountered in a Type I core and a Type II www.nature.com/scientificreports www.nature.com/scientificreports/ lesion), multiple neural networks operating at different visual scales (macro and micro) were used to limit misclassification of lesion types. No preprocessing of the images was employed in either training of the models or within the pipeline. The final approach, illustrated in Fig. 2 , employs a modular architecture [55] [56] [57] [58] with three CNNs and two human intervention checkpoints. After a digital image is uploaded, in a first step the macro-classifier (CNN1) identifies the Type I physiological structure with its characteristic caseous necrotic center and collagen rim. Human feedback is required after this initial step to reduce the false positive rate of Type II lesions misclassified as Type I lesions (see also in result section 1). The macro-classifier CNN1 will then identify the individual image areas either positively or negatively for the Type I pathology features. Based upon the macro-classifier CNN1 prediction, the digital image areas are partitioned into two separate data sets, classified as 'Type I' or 'not Type I' lesion. Subsequently, both the positively or negatively identified image areas are further analyzed at a microscopic level based on cell types, by either the CNN2 or the CNN3 micro-classifiers. Both CNN2 and CNN3 require that the digital image sections are tiled into individual image patches that are 80 \u00d7 145 pixels in size. In case a Type I lesion is detected after CNN1, then CNN2 analyzes these image patches further and classifies each image patch as either Type I Rim, Type I Core, Healthy Tissue, Miscellaneous, or Empty. The remaining image patches (not identified by CNN1) are in parallel further classified with CNN3 as either Type II, Type III, Healthy, Miscellaneous, or Empty.", "cite_spans": [{"start": 3130, "end": 3134, "text": "[55]", "ref_id": "BIBREF55"}, {"start": 3135, "end": 3139, "text": "[56]", "ref_id": "BIBREF56"}, {"start": 3140, "end": 3144, "text": "[57]", "ref_id": "BIBREF57"}, {"start": 3145, "end": 3149, "text": "[58]", "ref_id": null}], "ref_spans": [{"start": 3090, "end": 3096, "text": "Fig. 2", "ref_id": "FIGREF1"}], "section": "Methods"}, {"text": "The output of the implementation of the three CNNs use 'raw image patch counts' (RIPC) per classification category, which are sum of the tiled image patches for each classification. RPIC are classified, classification locations stored, and subsequently visualized as colored overlays on the digital image. Every classification category is represented by a different color for easy visual, qualitative analysis and result verification (See Fig. 1) . The classifications with unique colors for the seven pathology classifications are then overlaid and smoothed with a node labeling algorithm 74 , with each image patch classification being considered an individual node, onto the original H&E stained scanned digital image. The digital image of the lung lobe with colored overlay is then inspected and verified by the user at a second human intervention checkpoint, and at this point the user can make changes before the final classification calculations are performed (Fig. 2) . Ultimately, the final output of LIRA using the two human intervention checkpoints includes the enumeration of the various lesion types, as well as the calculation of the area of lung involvement per classification category (presented as RIPC and % lung involvement per category). The LIRA software will provide a plain text, comma separated values (CSV) file, that consists of an automated enumeration of the number of RIPC for every classification category (7 in total). With the individual RIPC per classification category, the software then calculates the total lung area RIPC. Based on these calculations, the estimated % involvement is automatically calculated for each classification category by using the RIPC number for each lesion type divided by the total tissue RIPC x 100. Both the RIPC for each classification, as well as the % of lung area for each classification, is presented to the user in a CSV file for each image. These output CSV files can be opened on any personal computer and will be displayed as an Excel file. The LIRA source code with accompanying documentation is available from https://Github.com/TB-imaging/LIRA neural network training. All CNNs in the LIRA Pipeline were trained using the Keras 2.0 machine learning framework in Python 3.5, on an NVIDIA Titan X GPU. Using a built-in human-in-the-loop classification tool for LIRA, trained research technicians assisted in creating the training set for CNN1 by collecting 791,000 individual image patches with a pixel size of 128 \u00d7 128. The purpose of these patches was solely to identify the Type I lesion structure at a macroscopic level. Additionally, 1.2 and 1.3 million image patches with a pixel size of 80 \u00d7 145 were collected in a similar manner for further classification at a microscopic level for both the Type 1 (CNN2) and Non-Type 1 lesion classification (CNN3), respectively. The image patches were generated as follows. In an initial step, the experienced technicians or pathologists performed manual labeling of the various classifications on an intact image. The specific regions of interests (ROI) for each classification type were subsequently extracted from the original image. The cropped ROIs were subsequently further divided into individual image patches. The reason for generating image patches for training from specific regions of interests (ROI) was primarily to prevent multiple conflicting labels being applied to a single lesion type. Due to the availability of data, not all lesion types were represented equally, which thereby created an unbalanced dataset. For training, we therefore did not use all generated image patches but these were random selected.", "cite_spans": [], "ref_spans": [{"start": 439, "end": 446, "text": "Fig. 1)", "ref_id": "FIGREF0"}, {"start": 967, "end": 975, "text": "(Fig. 2)", "ref_id": "FIGREF1"}], "section": "Methods"}, {"text": "Each CNN model was subsequently trained on the provided training set of image patches, with the following parameters as implemented in Keras 2.0. Values for training and validation were initially chosen using a Bayesian Optimization Algorithm and values were further adjusted by hand. The composition of each of the neural networks is presented in the Supplemental Information, Tables 1 and 2.", "cite_spans": [], "ref_spans": [], "section": "Methods"}, {"text": "Validation of software. After training the CNNs, a validation step was included using a separate digital image set. Validation of the entire LIRA pipeline was performed by comparing results to a classical manual pathology readout. First, the performance of the LIRA software was assessed to recognize the various lesion types, i.e., calculation of the percent error per lesion type by LIRA when compared to the analysis by the experienced TB researcher (as base line). Second, the percent agreement between four board-certified veterinary pathologists (American College of Veterinary Pathologists) was calculated by comparing the results after classifying image patches with and without LIRA assistance. Lastly, the histopathology readout was measured more robustly by calculating a reliability coefficient developed to measure the agreement among observers, using the Krippendorff 's alpha coefficient 75 . The coefficient was calculated and based on data generated by four board-certified veterinary pathologists with and without the use of LIRA, as well as four research technicians with the use of LIRA.", "cite_spans": [], "ref_spans": [], "section": "Methods"}, {"text": "To assess the agreement in the analysis by the pathologists with and without the use of LIRA, seven randomly selected scanned images of single lung lobes were selected for the software validation step. In a first step, the pathologists hand labeled each 80 \u00d7 145 pixel image patch using one out of seven classifications (same as described for LIRA). Data on every 80 \u00d7 145 pixel sized image patch classification was collected as RIPC. The hand labeled result by the pathologists and technicians generated a 7-color classification overlay for every digital image. The result also included the calculated RIPC for each of the seven classification categories for every digital image of a single lung lobe. In a second step, seven days later, the pathologists and research technicians were presented with the same seven digital images of lung lobes to review, this time with the assistance of LIRA predictions for both the macroscopic (CNN1) and microscopic classifications (CNN2, CNN3). Both the pathologists and technicians were requested to review the LIRA predictions, and to intervene and potentially modify the Type I lesion detection at the first intervention step (CNN1 LIRA prediction) and/or the individual image patch classifications at the second intervention step (CNN2, CNN3 LIRA prediction), if needed.", "cite_spans": [], "ref_spans": [], "section": "Methods"}, {"text": "The analysis of the validation results included the calculation of the percent agreement in prediction results between the four pathologists 76 . Using percent agreement does not take into account that classifications may have been selected by chance, it is however still a commonly used metric and useful as a first measurement in the context of this work 77, 78 .", "cite_spans": [{"start": 357, "end": 360, "text": "77,", "ref_id": "BIBREF78"}], "ref_spans": [], "section": "Methods"}, {"text": "As mentioned before, the classical histopathology readout is only semi-quantitative and, in some cases, subjective, which makes comparisons of the LIRA prediction results to a gold standard unreliable. To study the variance in readouts between the different pathologists after manually reviewing the digital images, we opted for an inter annotator comparison approach to calculate the agreement among the pathologists with and without LIRA. The Krippendorff 's alpha coefficient calculation using nominal data and any number of observers was implemented here as an analysis tool to quantify the agreement between the prediction results of multiple observers with or without assistance with LIRA. The Krippendorff 's alpha approach takes into account chance classifications, can be used with nominal data, using more than two raters, with multiple categories, plus the approach can be used with large datasets 79 . Each image patch was considered as a separate observation, and the classifications from all four pathologists were used for calculations. The Krippendorff 's alpha approach provides a coefficient between 0 and 1, with \u03b1 < 0.667 being rejected, \u03b1 \u2265 0.667 being the lowest acceptable limit, and \u03b1 \u2265 0.800 being considered to have good agreement 80 . These numbers were acquired by counting the number of true positives, true negatives, false positives, and false negatives within 70 digital images of lung lobes that had been classified by the CNN1 detector. This approach did not stipulate that the entire lesion was detected, but any area of the lesion be correctly or incorrectly identified.", "cite_spans": [], "ref_spans": [], "section": "Methods"}, {"text": "In order to determine the accuracy of CNN2 and CNN3, a standard or ground truth classification was established on 12 digital images by a researcher with substantial experience analyzing C3HeB/FeJ mouse pathology (author B.C.A.). The researcher manually labeled each image patch using one of the seven different classifications described earlier. The researcher was also the main individual training LIRA, and therefore this analysis was mainly aimed to investigate whether LIRA performed adequately and met expectations. The 12 digital images containing a lung lobe consisted of three images primarily composed of Healthy Tissue, three images primarily composed of Type I lesions, three images composed of Type II images, and three images composed primarily of Type III lesions. Total image patch counts for only the classification of interest were then used to calculate the percent error for each individual classification for LIRA compared to the manual labeling result by the researcher.", "cite_spans": [], "ref_spans": [], "section": "Methods"}, {"text": "The LIRA computer code was written in Python programming language, and is provided open source to the research community without any restrictions from https://Github.com/TB-imaging/LIRA, including the full source code, documentations and usage guidelines.", "cite_spans": [], "ref_spans": [], "section": "code availability"}], "bib_entries": {"BIBREF0": {"ref_id": "b0", "title": "World Health Organization Available at", "authors": [], "year": 2018, "venue": "", "volume": "", "issn": "", "pages": "", "other_ids": {}}, "BIBREF1": {"ref_id": "b1", "title": "The top 10 causes of death. World Health Organization Available at", "authors": [], "year": 2018, "venue": "", "volume": "", "issn": "", "pages": "", "other_ids": {}}, "BIBREF2": {"ref_id": "b2", "title": "The Tubercle Bacillus, in the Pulmonary Lesion of Man. Histobacteriology and Its Bearing on the Therapy of Pulmonary Tuberculosis. George Canetti", "authors": [{"first": "W", "middle": ["C"], "last": "Tobie", "suffix": ""}], "year": 1957, "venue": "Q. Rev. Biol", "volume": "32", "issn": "", "pages": "201--201", "other_ids": {}}, "BIBREF3": {"ref_id": "b3", "title": "The making of a social disease tuberculosis in nineteenth-century France", "authors": [{"first": "David", "middle": ["S"], "last": "Barnes", "suffix": ""}], "year": 1995, "venue": "", "volume": "", "issn": "", "pages": "", "other_ids": {}}, "BIBREF4": {"ref_id": "b4", "title": "Pathogenesis of Human Pulmonary Tuberculosis: Insights from the Rabbit Model By", "authors": [{"first": "J", "middle": ["L"], "last": "Cook", "suffix": ""}, {"first": "M", "middle": [], "last": "Arthur", "suffix": ""}, {"first": "", "middle": [], "last": "Dannenberg", "suffix": ""}, {"first": "D", "middle": ["C"], "last": "Washington", "suffix": ""}], "year": 2006, "venue": "", "volume": "44", "issn": "", "pages": "1257--1257", "other_ids": {}}, "BIBREF5": {"ref_id": "b5", "title": "Biology of the mycobacterioses. Pathogenesis of tuberculosis in man", "authors": [{"first": "G", "middle": [], "last": "Canetti", "suffix": ""}], "year": 1968, "venue": "Ann. N. Y. Acad. Sci", "volume": "154", "issn": "", "pages": "13--18", "other_ids": {}}, "BIBREF6": {"ref_id": "b6", "title": "Pathology of Post Primary Tuberculosis of the Lung: An Illustrated", "authors": [{"first": "R", "middle": ["L"], "last": "Hunter", "suffix": ""}], "year": 2011, "venue": "Critical Review. Tuberc. Edinb. Scotl", "volume": "91", "issn": "", "pages": "497--509", "other_ids": {}}, "BIBREF7": {"ref_id": "b7", "title": "Stress and Host Immunity Amplify Mycobacterium tuberculosis Phenotypic Heterogeneity and Induce Nongrowing Metabolically Active Forms", "authors": [{"first": "G", "middle": [], "last": "Manina", "suffix": ""}, {"first": "N", "middle": [], "last": "Dhar", "suffix": ""}, {"first": "J", "middle": ["D"], "last": "Mckinney", "suffix": ""}], "year": 2015, "venue": "Cell Host Microbe", "volume": "17", "issn": "", "pages": "32--46", "other_ids": {}}, "BIBREF8": {"ref_id": "b8", "title": "Host-pathogen coevolution in human tuberculosis", "authors": [{"first": "S", "middle": [], "last": "Gagneux", "suffix": ""}], "year": 2012, "venue": "Philos. Trans. R. Soc. B Biol. Sci", "volume": "367", "issn": "", "pages": "850--859", "other_ids": {}}, "BIBREF9": {"ref_id": "b9", "title": "Tuberculosis Chemotherapy: the Influence of Bacillary Stress and Damage Response Pathways on Drug Efficacy", "authors": [{"first": "D", "middle": ["F"], "last": "Warner", "suffix": ""}, {"first": "V", "middle": [], "last": "Mizrahi", "suffix": ""}], "year": 2006, "venue": "Clin. Microbiol. Rev", "volume": "19", "issn": "", "pages": "558--570", "other_ids": {}}, "BIBREF10": {"ref_id": "b10", "title": "Multiple M. tuberculosis Phenotypes in Mouse and Guinea Pig Lung Tissue Revealed by a Dual-Staining Approach", "authors": [{"first": "G", "middle": ["J"], "last": "Ryan", "suffix": ""}], "year": 2010, "venue": "PLOS ONE", "volume": "5", "issn": "", "pages": "", "other_ids": {}}, "BIBREF11": {"ref_id": "b11", "title": "Not Resistance, Is the Cause of Loss of Isoniazid Effect", "authors": [{"first": "R", "middle": ["S"], "last": "Wallis", "suffix": ""}, {"first": "M", "middle": [], "last": "Palaci", "suffix": ""}, {"first": "K", "middle": [], "last": "Eisenach", "suffix": ""}, {"first": "", "middle": [], "last": "Persistence", "suffix": ""}], "year": 2007, "venue": "J. Infect. Dis", "volume": "195", "issn": "", "pages": "1870--1871", "other_ids": {}}, "BIBREF13": {"ref_id": "b13", "title": "Bedaquiline and Pyrazinamide Treatment Responses Are Affected by Pulmonary Lesion Heterogeneity in Mycobacterium tuberculosis Infected C3HeB/FeJ Mice", "authors": [{"first": "S", "middle": ["M"], "last": "Irwin", "suffix": ""}], "year": 2016, "venue": "ACS Infect. Dis", "volume": "2", "issn": "", "pages": "251--267", "other_ids": {}}, "BIBREF14": {"ref_id": "b14", "title": "Phenotypic Heterogeneity in Mycobacterium tuberculosis", "authors": [{"first": "N", "middle": [], "last": "Dhar", "suffix": ""}, {"first": "J", "middle": [], "last": "Mckinney", "suffix": ""}, {"first": "G", "middle": [], "last": "Manina", "suffix": ""}], "year": 2016, "venue": "Microbiol. Spectr", "volume": "4", "issn": "", "pages": "", "other_ids": {}}, "BIBREF15": {"ref_id": "b15", "title": "Acquired Drug Resistance in Mycobacterium tuberculosis and Poor Outcomes among Patients with Multidrug-Resistant Tuberculosis", "authors": [{"first": "R", "middle": ["R"], "last": "Kempker", "suffix": ""}], "year": 2015, "venue": "Emerg. Infect. Dis", "volume": "21", "issn": "", "pages": "992--1001", "other_ids": {}}, "BIBREF16": {"ref_id": "b16", "title": "The value of end-of-treatment chest radiograph in predicting pulmonary tuberculosis relapse", "authors": [{"first": "C", "middle": ["D"], "last": "Hamilton", "suffix": ""}], "year": 2008, "venue": "", "volume": "", "issn": "", "pages": "", "other_ids": {}}, "BIBREF17": {"ref_id": "b17", "title": "Impact of Extensive Drug Resistance on Treatment Outcomes in Non-HIV-Infected Patients with Multidrug-Resistant Tuberculosis", "authors": [{"first": "H.-R", "middle": [], "last": "Kim", "suffix": ""}], "year": 2007, "venue": "Clin. Infect. Dis", "volume": "45", "issn": "", "pages": "1290--1295", "other_ids": {}}, "BIBREF18": {"ref_id": "b18", "title": "The association between sterilizing activity and drug distribution into tuberculosis lesions", "authors": [{"first": "B", "middle": [], "last": "Prideaux", "suffix": ""}], "year": 2015, "venue": "Nat. Med", "volume": "21", "issn": "", "pages": "1223--1227", "other_ids": {}}, "BIBREF19": {"ref_id": "b19", "title": "Replication Dynamics of Mycobacterium tuberculosis in Chronically Infected Mice", "authors": [{"first": "E", "middle": ["J"], "last": "Mu\u00f1oz-El\u00edas", "suffix": ""}], "year": 2005, "venue": "Infect. Immun", "volume": "73", "issn": "", "pages": "546--551", "other_ids": {}}, "BIBREF20": {"ref_id": "b20", "title": "Evaluation of a Mouse Model of Necrotic Granuloma Formation Using C3HeB/FeJ Mice for Testing of Drugs against Mycobacterium tuberculosis", "authors": [{"first": "E", "middle": ["R"], "last": "Driver", "suffix": ""}], "year": 2012, "venue": "Antimicrob. Agents Chemother", "volume": "56", "issn": "", "pages": "3181--3195", "other_ids": {}}, "BIBREF21": {"ref_id": "b21", "title": "Presence of multiple lesion types with vastly different microenvironments in C3HeB/FeJ mice following aerosol infection with Mycobacterium tuberculosis", "authors": [{"first": "S", "middle": ["M"], "last": "Irwin", "suffix": ""}], "year": 2015, "venue": "Dis. Model. Mech", "volume": "8", "issn": "", "pages": "591--602", "other_ids": {}}, "BIBREF22": {"ref_id": "b22", "title": "Limited Activity of Clofazimine as a Single Drug in a Mouse Model of Tuberculosis Exhibiting Caseous Necrotic Granulomas", "authors": [{"first": "S", "middle": ["M"], "last": "Irwin", "suffix": ""}], "year": 2014, "venue": "Antimicrob. Agents Chemother", "volume": "58", "issn": "", "pages": "4026--4034", "other_ids": {}}, "BIBREF23": {"ref_id": "b23", "title": "Mouse model of pulmonary cavitary tuberculosis and expression of matrix metalloproteinase-9", "authors": [{"first": "A", "middle": ["A"], "last": "Ordonez", "suffix": ""}], "year": 2016, "venue": "Dis. Model. Mech", "volume": "9", "issn": "", "pages": "779--788", "other_ids": {}}, "BIBREF24": {"ref_id": "b24", "title": "Genetic control of resistance to experimental infection with virulent Mycobacterium tuberculosis", "authors": [{"first": "I", "middle": [], "last": "Kramnik", "suffix": ""}, {"first": "W", "middle": ["F"], "last": "Dietrich", "suffix": ""}, {"first": "P", "middle": [], "last": "Demant", "suffix": ""}, {"first": "B", "middle": ["R"], "last": "Bloom", "suffix": ""}], "year": 2000, "venue": "Proc. Natl. Acad. Sci", "volume": "97", "issn": "", "pages": "8560--8565", "other_ids": {}}, "BIBREF25": {"ref_id": "b25", "title": "Ipr1 gene mediates innate immunity to tuberculosis", "authors": [{"first": "H", "middle": [], "last": "Pan", "suffix": ""}], "year": 2005, "venue": "Nature", "volume": "434", "issn": "", "pages": "767--772", "other_ids": {}}, "BIBREF26": {"ref_id": "b26", "title": "Radioiodinated DPA-713 Imaging Correlates with Bactericidal Activity of Tuberculosis Treatments in Mice", "authors": [{"first": "A", "middle": ["A"], "last": "Ordonez", "suffix": ""}], "year": 2015, "venue": "Antimicrob. Agents Chemother", "volume": "59", "issn": "", "pages": "642--649", "other_ids": {}}, "BIBREF27": {"ref_id": "b27", "title": "Tuberculosis Vaccine Types and Timings", "authors": [{"first": "I", "middle": ["M"], "last": "Orme", "suffix": ""}], "year": 2015, "venue": "Clin Vaccine Immunol", "volume": "22", "issn": "", "pages": "249--257", "other_ids": {}}, "BIBREF28": {"ref_id": "b28", "title": "Long-Term Protection against Tuberculosis following Vaccination with a Severely Attenuated Double Lysine and Pantothenate Auxotroph of Mycobacterium tuberculosis", "authors": [{"first": "V", "middle": ["K"], "last": "Sambandamurthy", "suffix": ""}], "year": 2005, "venue": "Infect. Immun", "volume": "73", "issn": "", "pages": "1196--1203", "other_ids": {}}, "BIBREF29": {"ref_id": "b29", "title": "A Sterilizing Tuberculosis Treatment Regimen Is Associated with Faster Clearance of Bacteria in Cavitary Lesions in Marmosets", "authors": [{"first": "L", "middle": ["E"], "last": "Via", "suffix": ""}], "year": 2015, "venue": "Antimicrob. Agents Chemother", "volume": "59", "issn": "", "pages": "4181--4189", "other_ids": {}}, "BIBREF30": {"ref_id": "b30", "title": "Comprehensive analysis of methods used for the evaluation of compounds against Mycobacterium tuberculosis", "authors": [], "year": null, "venue": "", "volume": "", "issn": "", "pages": "", "other_ids": {"DOI": ["10.1016/j.tube.2012.07.003"]}}, "BIBREF31": {"ref_id": "b31", "title": "Analysis of 18FDG PET/CT Imaging as a Tool for Studying Mycobacterium tuberculosis Infection and Treatment in Non-human Primates", "authors": [{"first": "A", "middle": ["G"], "last": "White", "suffix": ""}], "year": 2017, "venue": "JoVE J. Vis. Exp. e56375-e56375", "volume": "", "issn": "", "pages": "", "other_ids": {"DOI": ["10.3791/56375"]}}, "BIBREF32": {"ref_id": "b32", "title": "Infection Dynamics and Response to Chemotherapy in a Rabbit Model of Tuberculosis using [F-18]2-Fluoro-Deoxy-D-Glucose Positron Emission Tomography and Computed Tomography", "authors": [{"first": "L", "middle": [], "last": "Via", "suffix": ""}], "year": 2012, "venue": "Antimicrob. Agents Chemother", "volume": "56", "issn": "", "pages": "4391--402", "other_ids": {}}, "BIBREF33": {"ref_id": "b33", "title": "Differential Virulence and Disease Progression following Mycobacterium tuberculosis Complex Infection of the Common Marmoset (Callithrix jacchus)", "authors": [{"first": "L", "middle": ["E"], "last": "Via", "suffix": ""}], "year": 2013, "venue": "Infect. Immun", "volume": "81", "issn": "", "pages": "2909--2919", "other_ids": {}}, "BIBREF34": {"ref_id": "b34", "title": "Linezolid for Treatment of Chronic Extensively Drug-Resistant Tuberculosis", "authors": [{"first": "M", "middle": [], "last": "Lee", "suffix": ""}], "year": 2012, "venue": "N. Engl. J. Med", "volume": "367", "issn": "", "pages": "1508--1518", "other_ids": {}}, "BIBREF35": {"ref_id": "b35", "title": "PET/CT imaging correlates with treatment outcome in patients with multidrug-resistant tuberculosis", "authors": [{"first": "R", "middle": ["Y"], "last": "Chen", "suffix": ""}], "year": 2014, "venue": "Sci. Transl. Med", "volume": "6", "issn": "", "pages": "265--166", "other_ids": {}}, "BIBREF36": {"ref_id": "b36", "title": "Persisting PET-CT lesion activity and M. tuberculosis mRNA after pulmonary tuberculosis cure", "authors": [{"first": "S", "middle": ["T"], "last": "Malherbe", "suffix": ""}], "year": 2016, "venue": "Nat. Med", "volume": "22", "issn": "", "pages": "1094--1100", "other_ids": {}}, "BIBREF37": {"ref_id": "b37", "title": "Radiologic Responses in Cynomolgus Macaques for Assessing Tuberculosis Chemotherapy Regimens", "authors": [{"first": "P", "middle": ["L"], "last": "Lin", "suffix": ""}], "year": 2013, "venue": "Antimicrob. Agents Chemother", "volume": "57", "issn": "", "pages": "4237--4244", "other_ids": {}}, "BIBREF38": {"ref_id": "b38", "title": "Lymphadenitis as a major element of disease in the guinea pig model of tuberculosis", "authors": [{"first": "R", "middle": ["J"], "last": "Basaraba", "suffix": ""}], "year": 2006, "venue": "Tuberculosis", "volume": "86", "issn": "", "pages": "386--394", "other_ids": {}}, "BIBREF39": {"ref_id": "b39", "title": "Breast Cancer Multi-classification from Histopathological Images with Structured Deep Learning Model", "authors": [{"first": "Z", "middle": [], "last": "Han", "suffix": ""}], "year": 2017, "venue": "Sci. Rep", "volume": "7", "issn": "", "pages": "", "other_ids": {}}, "BIBREF40": {"ref_id": "b40", "title": "Dermatologist-level classification of skin cancer with deep neural networks", "authors": [{"first": "A", "middle": [], "last": "Esteva", "suffix": ""}], "year": 2017, "venue": "Nature", "volume": "542", "issn": "", "pages": "115--118", "other_ids": {}}, "BIBREF41": {"ref_id": "b41", "title": "Mitosis Detection in Breast Cancer Histology Images with Deep Neural Networks", "authors": [{"first": "D", "middle": ["C"], "last": "Cire\u015fan", "suffix": ""}, {"first": "A", "middle": [], "last": "Giusti", "suffix": ""}, {"first": "L", "middle": ["M"], "last": "Gambardella", "suffix": ""}, {"first": "J", "middle": [], "last": "Schmidhuber", "suffix": ""}, {"first": "K", "middle": [], "last": "Mori", "suffix": ""}, {"first": "I", "middle": [], "last": "Sakuma", "suffix": ""}, {"first": "Y", "middle": [], "last": "Sato", "suffix": ""}, {"first": "C", "middle": [], "last": "Barillot", "suffix": ""}, {"first": "N", "middle": [], "last": "Navab", "suffix": ""}], "year": 2013, "venue": "Medical Image Computing and Computer-Assisted Intervention -MICCAI 2013", "volume": "8150", "issn": "", "pages": "411--418", "other_ids": {}}, "BIBREF42": {"ref_id": "b42", "title": "Multi-Instance Deep Learning: Discover Discriminative Local Anatomies for Bodypart Recognition", "authors": [{"first": "Z", "middle": [], "last": "Yan", "suffix": ""}], "year": 2016, "venue": "IEEE Trans. Med. Imaging", "volume": "35", "issn": "", "pages": "1332--1343", "other_ids": {}}, "BIBREF43": {"ref_id": "b43", "title": "Unsupervised Deep Feature Learning for Deformable Registration of MR Brain Images", "authors": [{"first": "G", "middle": [], "last": "Wu", "suffix": ""}], "year": 2013, "venue": "Medical image computing and computer-assisted intervention: MICCAI\u2026 International Conference on Medical Image Computing and Computer-Assisted Intervention", "volume": "16", "issn": "", "pages": "649--56", "other_ids": {}}, "BIBREF44": {"ref_id": "b44", "title": "Large scale tissue histopathology image classification, segmentation, and visualization via deep convolutional activation features", "authors": [{"first": "Y", "middle": [], "last": "Xu", "suffix": ""}], "year": 2017, "venue": "BMC Bioinformatics", "volume": "18", "issn": "", "pages": "", "other_ids": {}}, "BIBREF46": {"ref_id": "b46", "title": "Convolutional Neural Networks for Histopathology Image Classification: Training vs. Using Pre-Trained Networks. ArXiv171005726 Cs", "authors": [{"first": "B", "middle": [], "last": "Kieffer", "suffix": ""}, {"first": "M", "middle": [], "last": "Babaie", "suffix": ""}, {"first": "S", "middle": [], "last": "Kalra", "suffix": ""}, {"first": "H", "middle": ["R"], "last": "Tizhoosh", "suffix": ""}], "year": 2017, "venue": "", "volume": "", "issn": "", "pages": "", "other_ids": {}}, "BIBREF47": {"ref_id": "b47", "title": "Automatic histopathology image analysis with CNNs", "authors": [{"first": "L", "middle": [], "last": "Hou", "suffix": ""}], "year": 2016, "venue": "New York Scientific Data Summit (NYSDS)", "volume": "", "issn": "", "pages": "1--6", "other_ids": {"DOI": ["10.1109/NYSDS.2016.7747812"]}}, "BIBREF48": {"ref_id": "b48", "title": "Classification of histopathological images using convolutional neural network", "authors": [{"first": "N", "middle": [], "last": "Hatipoglu", "suffix": ""}, {"first": "G", "middle": [], "last": "Bilgin", "suffix": ""}], "year": 2014, "venue": "4th International Conference on Image Processing Theory, Tools and Applications (IPTA) 1-6", "volume": "", "issn": "", "pages": "", "other_ids": {"DOI": ["10.1109/IPTA.2014.7001976"]}}, "BIBREF49": {"ref_id": "b49", "title": "Predicting cancer outcomes from histology and genomics using convolutional networks", "authors": [{"first": "P", "middle": [], "last": "Mobadersany", "suffix": ""}], "year": 2018, "venue": "Proc. Natl. Acad. Sci. 201717139", "volume": "", "issn": "", "pages": "", "other_ids": {"DOI": ["10.1073/pnas.1717139115"]}}, "BIBREF50": {"ref_id": "b50", "title": "Pixel-Based Classification Using Support Vector Machine Classifier", "authors": [{"first": "M", "middle": ["K S"], "last": "Varma", "suffix": ""}, {"first": "N", "middle": ["K K"], "last": "Rao", "suffix": ""}, {"first": "K", "middle": ["K"], "last": "Raju", "suffix": ""}, {"first": "G", "middle": ["P"], "last": "Varma", "suffix": ""}], "year": 2016, "venue": "IEEE 6th International Conference on Advanced Computing (IACC)", "volume": "", "issn": "", "pages": "51--55", "other_ids": {"DOI": ["10.1109/IACC.2016.20"]}}, "BIBREF51": {"ref_id": "b51", "title": "A Support Vector Machine Approach for Object Based Image Analysis", "authors": [{"first": "A", "middle": [], "last": "Tzotsos", "suffix": ""}], "year": null, "venue": "", "volume": "", "issn": "", "pages": "", "other_ids": {}}, "BIBREF52": {"ref_id": "b52", "title": "Convolutional networks for images, speech, and time-series", "authors": [{"first": "Y", "middle": [], "last": "Lecun", "suffix": ""}, {"first": "Y", "middle": [], "last": "Bengio", "suffix": ""}], "year": 1995, "venue": "Handb. Brain Theory Neural Netw", "volume": "", "issn": "", "pages": "", "other_ids": {}}, "BIBREF53": {"ref_id": "b53", "title": "Deep learning", "authors": [{"first": "Y", "middle": [], "last": "Lecun", "suffix": ""}, {"first": "Y", "middle": [], "last": "Bengio", "suffix": ""}, {"first": "G", "middle": [], "last": "Hinton", "suffix": ""}], "year": 2015, "venue": "Nature", "volume": "521", "issn": "", "pages": "436--444", "other_ids": {}}, "BIBREF55": {"ref_id": "b55", "title": "A modular neural network architecture with concept", "authors": [{"first": "Y", "middle": [], "last": "Ding", "suffix": ""}, {"first": "Q", "middle": [], "last": "Feng", "suffix": ""}, {"first": "T", "middle": [], "last": "Wang", "suffix": ""}, {"first": "X", "middle": [], "last": "Fu", "suffix": ""}], "year": 2014, "venue": "Neurocomputing", "volume": "125", "issn": "", "pages": "3--6", "other_ids": {}}, "BIBREF56": {"ref_id": "b56", "title": "Design and evolution of modular neural network architectures", "authors": [{"first": "B", "middle": ["L M"], "last": "Happel", "suffix": ""}, {"first": "J", "middle": ["M J"], "last": "Murre", "suffix": ""}], "year": 1994, "venue": "Neural Netw", "volume": "7", "issn": "", "pages": "985--1004", "other_ids": {}}, "BIBREF57": {"ref_id": "b57", "title": "Deep and Modular Neural Networks | SpringerLink. Available at", "authors": [], "year": 2018, "venue": "", "volume": "", "issn": "", "pages": "", "other_ids": {"DOI": ["https:/link.springer.com/chapter/10.1007/978-3-662-43505-2_28"]}}, "BIBREF59": {"ref_id": "b59", "title": "A Modular Neural Network System for the Analysis of Nuclei in Histopathological Sections. in Computational Intelligence Processing in Medical Diagnosis 291-322", "authors": [{"first": "C", "middle": ["S"], "last": "Pattichis", "suffix": ""}, {"first": "F", "middle": [], "last": "Schnorrenberg", "suffix": ""}, {"first": "C", "middle": ["N"], "last": "Schizas", "suffix": ""}, {"first": "M", "middle": ["S"], "last": "Pattichis", "suffix": ""}, {"first": "K", "middle": [], "last": "Kyriacou", "suffix": ""}], "year": 2002, "venue": "", "volume": "", "issn": "", "pages": "", "other_ids": {"DOI": ["10.1007/978-3-7908-1788-1_11"]}}, "BIBREF60": {"ref_id": "b60", "title": "Principles for valid histopathologic scoring in research", "authors": [{"first": "K", "middle": ["N"], "last": "Gibson-Corley", "suffix": ""}, {"first": "A", "middle": ["K"], "last": "Olivier", "suffix": ""}, {"first": "D", "middle": ["K"], "last": "Meyerholz", "suffix": ""}], "year": 2013, "venue": "Vet. Pathol", "volume": "50", "issn": "", "pages": "", "other_ids": {}}, "BIBREF61": {"ref_id": "b61", "title": "Multiparametric and semiquantitative scoring systems for the evaluation of mouse model histopathology -a systematic review", "authors": [{"first": "R", "middle": [], "last": "Klopfleisch", "suffix": ""}], "year": 2013, "venue": "BMC Vet. Res", "volume": "9", "issn": "", "pages": "", "other_ids": {}}, "BIBREF62": {"ref_id": "b62", "title": "Sources of variability in histological scoring of chronic viral hepatitis", "authors": [{"first": "M.-C", "middle": [], "last": "Rousselet", "suffix": ""}], "year": 2005, "venue": "Hepatology", "volume": "41", "issn": "", "pages": "257--264", "other_ids": {}}, "BIBREF63": {"ref_id": "b63", "title": "Observer Variability in the Interpretation of HER2/neu Immunohistochemical Expression With Unaided and Computer-Aided Digital Microscopy", "authors": [{"first": "M", "middle": ["A"], "last": "Gavrielides", "suffix": ""}, {"first": "B", "middle": ["D"], "last": "Gallas", "suffix": ""}, {"first": "P", "middle": [], "last": "Lenz", "suffix": ""}, {"first": "A", "middle": [], "last": "Badano", "suffix": ""}, {"first": "S", "middle": ["M"], "last": "Hewitt", "suffix": ""}], "year": 2011, "venue": "Arch. Pathol. Lab. Med", "volume": "135", "issn": "", "pages": "233--242", "other_ids": {}}, "BIBREF64": {"ref_id": "b64", "title": "Artificial Intelligence in Medical Practice: The Question to the Answer?", "authors": [{"first": "D", "middle": ["D"], "last": "Miller", "suffix": ""}, {"first": "E", "middle": ["W"], "last": "Brown", "suffix": ""}], "year": 2018, "venue": "Am. J. Med", "volume": "131", "issn": "", "pages": "129--133", "other_ids": {}}, "BIBREF65": {"ref_id": "b65", "title": "Generative Adversarial Networks. ArXiv14062661 Cs Stat", "authors": [{"first": "I", "middle": ["J"], "last": "Goodfellow", "suffix": ""}], "year": 2014, "venue": "", "volume": "", "issn": "", "pages": "", "other_ids": {}}, "BIBREF66": {"ref_id": "b66", "title": "How transferable are features in deep neural networks?", "authors": [{"first": "J", "middle": [], "last": "Yosinski", "suffix": ""}, {"first": "J", "middle": [], "last": "Clune", "suffix": ""}, {"first": "Y", "middle": [], "last": "Bengio", "suffix": ""}, {"first": "H", "middle": [], "last": "Lipson", "suffix": ""}, {"first": "Z", "middle": [], "last": "Ghahramani", "suffix": ""}, {"first": "M", "middle": [], "last": "Welling", "suffix": ""}, {"first": "C", "middle": [], "last": "Cortes", "suffix": ""}, {"first": "N", "middle": ["D"], "last": "Lawrence", "suffix": ""}, {"first": "K", "middle": ["Q"], "last": "Weinberger", "suffix": ""}], "year": 2014, "venue": "Advances in Neural Information Processing Systems", "volume": "27", "issn": "", "pages": "3320--3328", "other_ids": {}}, "BIBREF67": {"ref_id": "b67", "title": "Improving acid-fast fluorescent staining for the detection of mycobacteria using a new nucleic acid staining approach", "authors": [{"first": "G", "middle": [], "last": "Ryan", "suffix": ""}, {"first": "H", "middle": [], "last": "Shapiro", "suffix": ""}, {"first": "A", "middle": [], "last": "Lenaerts", "suffix": ""}], "year": 2014, "venue": "", "volume": "94", "issn": "", "pages": "", "other_ids": {}}, "BIBREF68": {"ref_id": "b68", "title": "Heterogeneity in tuberculosis pathology, microenvironments and therapeutic responses", "authors": [{"first": "A", "middle": [], "last": "Lenaerts", "suffix": ""}, {"first": "C", "middle": ["E"], "last": "Barry", "suffix": ""}, {"first": "V", "middle": [], "last": "Dartois", "suffix": ""}], "year": 2015, "venue": "Immunol. Rev", "volume": "264", "issn": "", "pages": "288--307", "other_ids": {}}, "BIBREF69": {"ref_id": "b69", "title": "Visualization of Mycobacterial Biomarkers and Tuberculosis Drugs in Infected Tissue by MALDI-MS Imaging", "authors": [{"first": "L", "middle": [], "last": "Blanc", "suffix": ""}, {"first": "A", "middle": [], "last": "Lenaerts", "suffix": ""}, {"first": "V", "middle": [], "last": "Dartois", "suffix": ""}, {"first": "B", "middle": [], "last": "Prideaux", "suffix": ""}], "year": 2018, "venue": "Anal. Chem", "volume": "90", "issn": "", "pages": "6275--6282", "other_ids": {}}, "BIBREF70": {"ref_id": "b70", "title": "Virulence ranking of some Mycobacterium tuberculosis and Mycobacterium bovis strains according to their ability to multiply in the lungs, induce lung pathology, and cause mortality in mice", "authors": [{"first": "P", "middle": ["L"], "last": "Dunn", "suffix": ""}, {"first": "R", "middle": ["J"], "last": "North", "suffix": ""}], "year": 1995, "venue": "Infect. Immun", "volume": "63", "issn": "", "pages": "3428--3437", "other_ids": {}}, "BIBREF71": {"ref_id": "b71", "title": "Low-dose aerosol infection model for testing drugs for efficacy against Mycobacterium tuberculosis", "authors": [{"first": "B", "middle": ["P"], "last": "Kelly", "suffix": ""}, {"first": "S", "middle": ["K"], "last": "Furney", "suffix": ""}, {"first": "M", "middle": ["T"], "last": "Jessen", "suffix": ""}, {"first": "I", "middle": ["M"], "last": "Orme", "suffix": ""}], "year": 1996, "venue": "Antimicrob. Agents Chemother", "volume": "40", "issn": "", "pages": "2809--2812", "other_ids": {}}, "BIBREF72": {"ref_id": "b72", "title": "Comparative Studies Evaluating Mouse Models Used for Efficacy Testing of Experimental Drugs against Mycobacterium tuberculosis", "authors": [{"first": "M", "middle": ["A"], "last": "De Groote", "suffix": ""}], "year": 2011, "venue": "Antimicrob. Agents Chemother", "volume": "55", "issn": "", "pages": "1237--1247", "other_ids": {}}, "BIBREF73": {"ref_id": "b73", "title": "IL-10 Inhibits Mature Fibrotic Granuloma Formation during Mycobacterium tuberculosis Infection", "authors": [{"first": "J", "middle": ["C"], "last": "Cyktor", "suffix": ""}], "year": 2013, "venue": "J. Immunol", "volume": "1202722", "issn": "", "pages": "", "other_ids": {"DOI": ["10.4049/jimmunol.1202722"]}}, "BIBREF74": {"ref_id": "b74", "title": "The Chemokine Receptor CXCR3 Attenuates the Control of Chronic Mycobacterium tuberculosis Infection in BALB/c Mice", "authors": [{"first": "S", "middle": ["D"], "last": "Chakravarty", "suffix": ""}], "year": 2007, "venue": "J. Immunol", "volume": "178", "issn": "", "pages": "1723--1735", "other_ids": {}}, "BIBREF75": {"ref_id": "b75", "title": "Labeling Nodes Using Three Degrees of Propagation", "authors": [], "year": 2018, "venue": "", "volume": "", "issn": "", "pages": "", "other_ids": {"DOI": ["http:/journals.plos.org/plosone/article?id=10.1371/journal.pone.0051947"]}}, "BIBREF76": {"ref_id": "b76", "title": "Various Coefficients of Interrater Reliability and Agreement", "authors": [{"first": "M", "middle": [], "last": "Gamer", "suffix": ""}, {"first": "J", "middle": [], "last": "Lemon", "suffix": ""}, {"first": "I", "middle": ["F P"], "last": "Singh", "suffix": ""}, {"first": "", "middle": [], "last": "Irr", "suffix": ""}], "year": 2019, "venue": "", "volume": "", "issn": "", "pages": "", "other_ids": {}}, "BIBREF77": {"ref_id": "b77", "title": "Measuring nominal scale agreement among many raters", "authors": [{"first": "J", "middle": ["L"], "last": "Fleiss", "suffix": ""}], "year": 1971, "venue": "Psychol. Bull", "volume": "76", "issn": "", "pages": "378--382", "other_ids": {}}, "BIBREF78": {"ref_id": "b78", "title": "Computing Inter-Rater Reliability for Observational Data: An Overview and Tutorial", "authors": [{"first": "K", "middle": ["A"], "last": "Hallgren", "suffix": ""}], "year": 2012, "venue": "Tutor. Quant. Methods Psychol", "volume": "8", "issn": "", "pages": "23--34", "other_ids": {}}, "BIBREF79": {"ref_id": "b79", "title": "Interrater reliability: the kappa statistic", "authors": [{"first": "M", "middle": ["L"], "last": "Mchugh", "suffix": ""}], "year": 2012, "venue": "Biochem. Medica", "volume": "22", "issn": "", "pages": "276--282", "other_ids": {}}, "BIBREF80": {"ref_id": "b80", "title": "Computing Krippendorff 's Alpha-Reliability", "authors": [{"first": "K", "middle": [], "last": "Krippendorff", "suffix": ""}], "year": null, "venue": "", "volume": "12", "issn": "", "pages": "", "other_ids": {}}, "BIBREF81": {"ref_id": "b81", "title": "Content analysis an introduction to its methodology", "authors": [{"first": "K", "middle": [], "last": "Krippendorff", "suffix": ""}], "year": 2019, "venue": "", "volume": "", "issn": "", "pages": "", "other_ids": {}}}, "ref_entries": {"FIGREF0": {"text": "Description of the various classifications in C3HeB/FeJ lung pathology used in LIRA.", "latex": null, "type": "figure"}, "FIGREF1": {"text": "Graphical representation of the LIRA digital imaging analysis workflow.", "latex": null, "type": "figure"}, "FIGREF2": {"text": "Digital Image Histopathology Data from Pathologists With and Without LIRA assistance. Color overlay results of 4 images from the image validation set with (a) Image 3, (b) Image 5, (c) Image 2, and (d) Image 7. The far left images are from pathologist 2 with the most accurate hand labeled results, the middle images are from pathologist 1 with the least accurately labeled results, and the images on the right hand side show the results of pathologist 1 with the assistance of LIRA.", "latex": null, "type": "figure"}, "FIGREF3": {"text": "Visual representations of the classifications made during each step in LIRA using colored overlays.", "latex": null, "type": "figure"}, "FIGREF4": {"text": ". evaluation metrics for performance and accuracy of the neural networks. For CNN1 the sensitiv-", "latex": null, "type": "figure"}, "TABREF1": {"text": "Table 2. Agreement of the pathologist readouts with LIRA assistance (Path+LIRA) and without (Path) by measuring percent agreement and Krippendorfs alpha.(2020) 10:6047 | https://doi.org/10.1038/s41598-020-62960-6", "latex": null, "type": "table"}, "TABREF2": {"text": "Table 1.\u2002 Accuracy of the LIRA predictions for the various lesion classifications measured by percent error agreement. N: number of digital images analyzed.", "latex": null, "type": "table", "html": "<html><body><table><tr><td>\u00a0</td><td>LIRA % Error\n</td></tr><tr><td>Healthy Tissue (n\u2009=\u20093) </td><td>1.975\n</td></tr><tr><td>Type I - Caseum (n\u2009=\u20093) </td><td>17.324\n</td></tr><tr><td>Type I - Rim (n\u2009=\u20093) </td><td>8.324\n</td></tr><tr><td>Type II (n\u2009=\u20093) </td><td>38.374\n</td></tr><tr><td>Type III (n\u2009=\u20093) </td><td>2.829\n</td></tr><tr><td>Total (n\u2009=\u200912) </td><td>12.107\n</td></tr></table></body></html>"}, "TABREF3": {"text": "Table 2.\u2002 Agreement of the pathologist readouts with LIRA assistance (Path + LIRA) and without (Path) by measuring percent agreement and Krippendorfs alpha.", "latex": null, "type": "table", "html": "<html><body><table><tr><td>\u00a0</td><td>Percent Agreement </td><td>Krippendorfs Alpha\n</td></tr><tr><td>Image\n</td><td>Path </td><td>Path + LIRA </td><td>Path </td><td>Path + LIRA\n</td></tr><tr><td>1 </td><td>84% </td><td>94% </td><td>0.761 </td><td>0.904\n</td></tr><tr><td>2 </td><td>92% </td><td>97% </td><td>0.864 </td><td>0.951\n</td></tr><tr><td>3 </td><td>84% </td><td>94% </td><td>0.757 </td><td>0.902\n</td></tr><tr><td>4 </td><td>92% </td><td>94% </td><td>0.860 </td><td>0.903\n</td></tr><tr><td>5 </td><td>90% </td><td>95% </td><td>0.849 </td><td>0.920\n</td></tr><tr><td>6 </td><td>84% </td><td>93% </td><td>0.757 </td><td>0.891\n</td></tr><tr><td>7 </td><td>82% </td><td>93% </td><td>0.725 </td><td>0.896\n</td></tr><tr><td>Mean </td><td>87% </td><td>94% </td><td>0.796 </td><td>0.910\n</td></tr></table></body></html>"}}, "back_matter": [{"text": "We would like to thank the TB Drug Accelerator (BMGF) and the Global Alliance for TB Drug Development for their assistance with earlier mouse studies, which provided the necessary histopathology samples for training of the new software. We thank the Bill & Melinda Gates Foundation for funding this work, Grant number OPP 1126594.", "cite_spans": [], "ref_spans": [], "section": "Acknowledgements"}, {"text": "The authors declare no competing interests.", "cite_spans": [], "ref_spans": [], "section": "competing interests"}, {"text": "Supplementary information is available for this paper at https://doi.org/10.1038/s41598-020-62960-6.Correspondence and requests for materials should be addressed to A.J.L.Reprints and permissions information is available at www.nature.com/reprints.Publisher's note Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.Open Access This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons license, and indicate if changes were made. The images or other third party material in this article are included in the article's Creative Commons license, unless indicated otherwise in a credit line to the material. If material is not included in the article's Creative Commons license and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this license, visit http://creativecommons.org/licenses/by/4.0/.", "cite_spans": [], "ref_spans": [], "section": "Additional information"}]}